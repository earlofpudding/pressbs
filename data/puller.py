""" 
PR Newswire Crawler

Pulls all available press releases from a given PR Newswire page

"""

import requests
import csv
import re
from bs4 import BeautifulSoup, NavigableString

link = input("Please enter the base url that lists the press releases you wish to download\n")
filename = input("Please enter the name of the output csv file\n")

csv_file =  filename + ".csv"
baseLink = "https://www.prnewswire.com"

csv_columns = ['article_number', 'article_link', 'article_name', 'article_content']
csv_content = []

r = requests.get(link)

if (r.status_code != 200):
    print("Error accessing the link\n")
else:
    rawList = BeautifulSoup(r.content, "html.parser")

    # Filter down to the div containing list of all articles
    linkList = rawList.find_all(href=re.compile("news-release"))
    articleCount = 0

    continueCheck = input("We found " + str(len(linkList)) + " articles, continue fetching? (Y/N) \n")
    if (continueCheck == "Y") or (continueCheck == "y"):
        for i in linkList:
            filterList = ['/in/news-releases/', '/il/news-releases/', '/ae/news-releases/', '/news-releases/', '/news-releases', '/news-releases/news-releases-list/', '/news-releases/all-public-company-news/', '/news-releases/english-releases/', '/news-releases/multimedia/', '/news-releases/multimedia/multimedia-list/', '/news-releases/photos/photos-list/', '/news-releases/videos/videos-list/', '/news-releases/multimedia/', '/news-releases/latest-news-topics/', '/news-releases/latest-news-topics/', '/news-releases/automotive-transportation-latest-news/', '/news-releases/automotive-transportation-latest-news/automotive-transportation-latest-news-list/', '/news-releases/automotive-transportation-latest-news/aerospace-defense-list/', '/news-releases/automotive-transportation-latest-news/', '/news-releases/automotive-transportation-latest-news/air-freight-list/', '/news-releases/automotive-transportation-latest-news/airlines-aviation-list/', '/news-releases/automotive-transportation-latest-news/automotive-list/', '/news-releases/automotive-transportation-latest-news/maritime-shipbuilding-list/', '/news-releases/automotive-transportation-latest-news/railroads-and-intermodal-transportation-list/', '/news-releases/automotive-transportation-latest-news/supply-chain-logistics-list/', '/news-releases/automotive-transportation-latest-news/transportation-trucking-railroad-list/', '/news-releases/automotive-transportation-latest-news/travel-list/', '/news-releases/automotive-transportation-latest-news/trucking-and-road-transportation-list/', '/news-releases/business-technology-latest-news/', '/news-releases/business-technology-latest-news/business-technology-latest-news-list/', '/news-releases/business-technology-latest-news/', '/news-releases/business-technology-latest-news/blockchain-list/', '/news-releases/business-technology-latest-news/broadcast-tech-list/', '/news-releases/business-technology-latest-news/computer-electronics-list/', '/news-releases/business-technology-latest-news/computer-hardware-list/', '/news-releases/business-technology-latest-news/computer-software-list/', '/news-releases/business-technology-latest-news/data-analytics-list/', '/news-releases/business-technology-latest-news/electronic-commerce-list/', '/news-releases/business-technology-latest-news/electronic-components-list/', '/news-releases/business-technology-latest-news/electronic-design-automation-list/', '/news-releases/business-technology-latest-news/financial-technology-list/', '/news-releases/business-technology-latest-news/high-tech-security-list/', '/news-releases/business-technology-latest-news/internet-technology-list/', '/news-releases/business-technology-latest-news/nanotechnology-list/', '/news-releases/business-technology-latest-news/networks-list/', '/news-releases/business-technology-latest-news/peripherals-list/', '/news-releases/business-technology-latest-news/semiconductors-list/', '/news-releases/entertainment-media-latest-news/', '/news-releases/entertainment-media-latest-news/entertainment-media-latest-news-list/', '/news-releases/entertainment-media-latest-news/advertising-list/', '/news-releases/entertainment-media-latest-news/', '/news-releases/entertainment-media-latest-news/art-list/', '/news-releases/entertainment-media-latest-news/books-list/', '/news-releases/entertainment-media-latest-news/entertainment-list/', '/news-releases/entertainment-media-latest-news/film-and-motion-picture-list/', '/news-releases/entertainment-media-latest-news/magazines-list/', '/news-releases/entertainment-media-latest-news/music-list/', '/news-releases/entertainment-media-latest-news/publishing-information-services-list/', '/news-releases/entertainment-media-latest-news/radio-list/', '/news-releases/entertainment-media-latest-news/television-list/', '/news-releases/financial-services-latest-news/', '/news-releases/financial-services-latest-news/financial-services-latest-news-list/', '/news-releases/financial-services-latest-news/accounting-news-issues-list/', '/news-releases/financial-services-latest-news/', '/news-releases/financial-services-latest-news/acquisitions-mergers-and-takeovers-list/', '/news-releases/financial-services-latest-news/banking-financial-services-list/', '/news-releases/financial-services-latest-news/bankruptcy-list/', '/news-releases/financial-services-latest-news/bond-stock-ratings-list/', '/news-releases/financial-services-latest-news/conference-call-announcements-list/', '/news-releases/financial-services-latest-news/contracts-list/', '/news-releases/financial-services-latest-news/cryptocurrency-list/', '/news-releases/financial-services-latest-news/dividends-list/', '/news-releases/financial-services-latest-news/earnings-list/', '/news-releases/financial-services-latest-news/earnings-forecasts-projections-list/', '/news-releases/financial-services-latest-news/financing-agreements-list/', '/news-releases/financial-services-latest-news/insurance-list/', '/news-releases/financial-services-latest-news/investment-opinions-list/', '/news-releases/financial-services-latest-news/joint-ventures-list/', '/news-releases/financial-services-latest-news/mutual-funds-list/', '/news-releases/financial-services-latest-news/private-placement-list/', '/news-releases/financial-services-latest-news/real-estate-list/', '/news-releases/financial-services-latest-news/restructuring-recapitalization-list/', '/news-releases/financial-services-latest-news/sales-reports-list/', '/news-releases/financial-services-latest-news/shareholder-activism-list/', '/news-releases/financial-services-latest-news/stock-offering-list/', '/news-releases/financial-services-latest-news/stock-split-list/', '/news-releases/financial-services-latest-news/venture-capital-list/', '/news-releases/general-business-latest-news/', '/news-releases/general-business-latest-news/general-business-latest-news-list/', '/news-releases/general-business-latest-news/', '/news-releases/general-business-latest-news/awards-list/', '/news-releases/general-business-latest-news/commercial-real-estate-list/', '/news-releases/general-business-latest-news/corporate-expansion-list/', '/news-releases/general-business-latest-news/earnings-list/', '/news-releases/general-business-latest-news/human-resource-workforce-management-list/', '/news-releases/general-business-latest-news/licensing-list/', '/news-releases/general-business-latest-news/new-products-services-list/', '/news-releases/general-business-latest-news/obituaries-list/', '/news-releases/general-business-latest-news/outsourcing-businesses-list/', '/news-releases/general-business-latest-news/overseas-real-estate-list/', '/news-releases/general-business-latest-news/personnel-announcements-list/', '/news-releases/general-business-latest-news/real-estate-transactions-list/', '/news-releases/general-business-latest-news/residential-real-estate-list/', '/news-releases/general-business-latest-news/small-business-services-list/', '/news-releases/general-business-latest-news/socially-responsible-investing-list/', '/news-releases/general-business-latest-news/surveys-polls-and-research-list/', '/news-releases/general-business-latest-news/trade-show-news-list/', '/news-releases/consumer-technology-latest-news/', '/news-releases/consumer-technology-latest-news/consumer-technology-latest-news-list/', '/news-releases/consumer-technology-latest-news/', '/news-releases/consumer-technology-latest-news/artificial-intelligence-list/', '/news-releases/consumer-technology-latest-news/blockchain-list/', '/news-releases/consumer-technology-latest-news/cloud-computing-internet-of-things-list/', '/news-releases/consumer-technology-latest-news/computer-electronics-list/', '/news-releases/consumer-technology-latest-news/computer-hardware-list/', '/news-releases/consumer-technology-latest-news/computer-software-list/', '/news-releases/consumer-technology-latest-news/consumer-electronics-list/', '/news-releases/consumer-technology-latest-news/cryptocurrency-list/', '/news-releases/consumer-technology-latest-news/data-analytics-list/', '/news-releases/consumer-technology-latest-news/electronic-commerce-list/', '/news-releases/consumer-technology-latest-news/electronic-gaming-list/', '/news-releases/consumer-technology-latest-news/financial-technology-list/', '/news-releases/consumer-technology-latest-news/mobile-entertainment-list/', '/news-releases/consumer-technology-latest-news/multimedia-internet-list/', '/news-releases/consumer-technology-latest-news/peripherals-list/', '/news-releases/consumer-technology-latest-news/social-media-list/', '/news-releases/consumer-technology-latest-news/science-tech-engineering-math-list/', '/news-releases/consumer-technology-latest-news/supply-chain-logistics-list/', '/news-releases/consumer-technology-latest-news/wireless-communications-list/', '/news-releases/energy-latest-news/', '/news-releases/energy-latest-news/energy-latest-news-list/', '/news-releases/energy-latest-news/', '/news-releases/energy-latest-news/alternative-energies-list/', '/news-releases/energy-latest-news/chemical-list/', '/news-releases/energy-latest-news/electrical-utilities-list/', '/news-releases/energy-latest-news/gas-list/', '/news-releases/energy-latest-news/general-manufacturing-list/', '/news-releases/energy-latest-news/mining-list/', '/news-releases/energy-latest-news/mining-metals-list/', '/news-releases/energy-latest-news/oil-energy-list/', '/news-releases/energy-latest-news/oil-and-gas-discoveries-list/', '/news-releases/energy-latest-news/utilities-list/', '/news-releases/energy-latest-news/water-utilities-list/', '/news-releases/environment-latest-news/', '/news-releases/environment-latest-news/environment-latest-news-list/', '/news-releases/environment-latest-news/', '/news-releases/environment-latest-news/conservation-recycling-list/', '/news-releases/environment-latest-news/environmental-issues-list/', '/news-releases/environment-latest-news/environmental-policy-list/', '/news-releases/environment-latest-news/environmental-products-services-list/', '/news-releases/environment-latest-news/green-technology-list/', '/news-releases/environment-latest-news/natural-disasters/', '/news-releases/heavy-industry-manufacturing-latest-news/', '/news-releases/heavy-industry-manufacturing-latest-news/heavy-industry-manufacturing-latest-news-list/', '/news-releases/heavy-industry-manufacturing-latest-news/aerospace-defense-list/', '/news-releases/heavy-industry-manufacturing-latest-news/', '/news-releases/heavy-industry-manufacturing-latest-news/agriculture-list/', '/news-releases/heavy-industry-manufacturing-latest-news/chemical-list/', '/news-releases/heavy-industry-manufacturing-latest-news/construction-building-list/', '/news-releases/heavy-industry-manufacturing-latest-news/general-manufacturing-list/', '/news-releases/heavy-industry-manufacturing-latest-news/hvac-list/', '/news-releases/heavy-industry-manufacturing-latest-news/machinery-list/', '/news-releases/heavy-industry-manufacturing-latest-news/machine-tools-metalworking-and-metallury-list/', '/news-releases/heavy-industry-manufacturing-latest-news/mining-list/', '/news-releases/heavy-industry-manufacturing-latest-news/mining-metals-list/', '/news-releases/heavy-industry-manufacturing-latest-news/paper-forest-products-containers-list/', '/news-releases/heavy-industry-manufacturing-latest-news/precious-metals-list/', '/news-releases/heavy-industry-manufacturing-latest-news/textiles-list/', '/news-releases/heavy-industry-manufacturing-latest-news/tobacco-list/', '/news-releases/telecommunications-latest-news/', '/news-releases/telecommunications-latest-news/telecommunications-latest-news-list/', '/news-releases/telecommunications-latest-news/', '/news-releases/telecommunications-latest-news/carriers-and-services-list/', '/news-releases/telecommunications-latest-news/mobile-entertainment-list/', '/news-releases/telecommunications-latest-news/networks-list/', '/news-releases/telecommunications-latest-news/peripherals-list/', '/news-releases/telecommunications-latest-news/telecommunications-equipment-list/', '/news-releases/telecommunications-latest-news/telecommunications-industry-list/', '/news-releases/telecommunications-latest-news/voip-list/', '/news-releases/telecommunications-latest-news/wireless-communications-list/', '/news-releases/consumer-products-retail-latest-news/', '/news-releases/consumer-products-retail-latest-news/consumer-products-retail-latest-news-list/', '/news-releases/consumer-products-retail-latest-news/', '/news-releases/consumer-products-retail-latest-news/animals-pets-list/', '/news-releases/consumer-products-retail-latest-news/beers-wines-and-spirits-list/', '/news-releases/consumer-products-retail-latest-news/beverages-list/', '/news-releases/consumer-products-retail-latest-news/bridal-services-list/', '/news-releases/consumer-products-retail-latest-news/cannabis-list/', '/news-releases/consumer-products-retail-latest-news/cosmetics-and-personal-care-list/', '/news-releases/consumer-products-retail-latest-news/fashion-list/', '/news-releases/consumer-products-retail-latest-news/food-beverages-list/', '/news-releases/consumer-products-retail-latest-news/furniture-and-furnishings-list/', '/news-releases/consumer-products-retail-latest-news/home-improvements-list/', '/news-releases/consumer-products-retail-latest-news/household-consumer-cosmetics-list/', '/news-releases/consumer-products-retail-latest-news/household-products-list/', '/news-releases/consumer-products-retail-latest-news/jewelry-list/', '/news-releases/consumer-products-retail-latest-news/non-alcoholic-beverages-list/', '/news-releases/consumer-products-retail-latest-news/office-products-list/', '/news-releases/consumer-products-retail-latest-news/organic-food-list/', '/news-releases/consumer-products-retail-latest-news/product-recalls-list/', '/news-releases/consumer-products-retail-latest-news/restaurants-list/', '/news-releases/consumer-products-retail-latest-news/retail-list/', '/news-releases/consumer-products-retail-latest-news/supermarkets-list/', '/news-releases/consumer-products-retail-latest-news/toys-list/', '/news-releases/entertainment-media-latest-news/', '/news-releases/entertainment-media-latest-news/entertainment-media-latest-news-list/', '/news-releases/entertainment-media-latest-news/advertising-list/', '/news-releases/entertainment-media-latest-news/', '/news-releases/entertainment-media-latest-news/art-list/', '/news-releases/entertainment-media-latest-news/books-list/', '/news-releases/entertainment-media-latest-news/entertainment-list/', '/news-releases/entertainment-media-latest-news/film-and-motion-picture-list/', '/news-releases/entertainment-media-latest-news/magazines-list/', '/news-releases/entertainment-media-latest-news/music-list/', '/news-releases/entertainment-media-latest-news/publishing-information-services-list/', '/news-releases/entertainment-media-latest-news/radio-list/', '/news-releases/entertainment-media-latest-news/television-list/', '/news-releases/health-latest-news/', '/news-releases/health-latest-news/health-latest-news-list/', '/news-releases/health-latest-news/', '/news-releases/health-latest-news/biometrics-list/', '/news-releases/health-latest-news/biotechnology-list/', '/news-releases/health-latest-news/clinical-trials-medical-discoveries-list/', '/news-releases/health-latest-news/dentistry-list/', '/news-releases/health-latest-news/fda-approval-list/', '/news-releases/health-latest-news/fitness-wellness-list/', '/news-releases/health-latest-news/health-care-hospitals-list/', '/news-releases/health-latest-news/health-insurance-list/', '/news-releases/health-latest-news/infection-control-list/', '/news-releases/health-latest-news/international-medical-approval-list/', '/news-releases/health-latest-news/medical-equipment-list/', '/news-releases/health-latest-news/medical-pharmaceuticals-list/', '/news-releases/health-latest-news/mental-health-list/', '/news-releases/health-latest-news/pharmaceuticals-list/', '/news-releases/health-latest-news/supplementary-medicine-list/', '/news-releases/sports-latest-news/', '/news-releases/sports-latest-news/sports-latest-news-list/', '/news-releases/sports-latest-news/', '/news-releases/sports-latest-news/general-sports-list/', '/news-releases/sports-latest-news/outdoors-camping-hiking-list/', '/news-releases/sports-latest-news/sporting-events-list/', '/news-releases/sports-latest-news/sports-equipment-accessories-list/', '/news-releases/travel-latest-news/', '/news-releases/travel-latest-news/travel-latest-news-list/', '/news-releases/travel-latest-news/', '/news-releases/travel-latest-news/amusement-parks-and-tourist-attractions-list/', '/news-releases/travel-latest-news/gambling-casinos-list/', '/news-releases/travel-latest-news/hotels-and-resorts-list/', '/news-releases/travel-latest-news/leisure-tourism-list/', '/news-releases/travel-latest-news/outdoors-camping-hiking-list/', '/news-releases/travel-latest-news/passenger-aviation-list/', '/news-releases/travel-latest-news/travel-industry-list/', '/news-releases/policy-public-interest-latest-news/', '/news-releases/policy-public-interest-latest-news/policy-public-interest-latest-news-list/', '/news-releases/policy-public-interest-latest-news/advocacy-group-opinion-list/', '/news-releases/policy-public-interest-latest-news/', '/news-releases/policy-public-interest-latest-news/animal-welfare-list/', '/news-releases/policy-public-interest-latest-news/corporate-social-responsibility-list/', '/news-releases/policy-public-interest-latest-news/domestic-policy-list/', '/news-releases/policy-public-interest-latest-news/economic-news-trends-analysis-list/', '/news-releases/policy-public-interest-latest-news/education-list/', '/news-releases/policy-public-interest-latest-news/environmental-list/', '/news-releases/policy-public-interest-latest-news/european-government-list/', '/news-releases/policy-public-interest-latest-news/fda-approval-list/', '/news-releases/policy-public-interest-latest-news/federal-and-state-legislation-list/', '/news-releases/policy-public-interest-latest-news/federal-executive-branch-agency-news-list/', '/news-releases/policy-public-interest-latest-news/foreign-policy-international-affairs-list/', '/news-releases/policy-public-interest-latest-news/homeland-security-list/', '/news-releases/policy-public-interest-latest-news/labor-union-news-list/', '/news-releases/policy-public-interest-latest-news/legal-issues-list/', '/news-releases/policy-public-interest-latest-news/natural-disasters-list/', '/news-releases/policy-public-interest-latest-news/not-for-profit-list/', '/news-releases/policy-public-interest-latest-news/patent-law-list/', '/news-releases/policy-public-interest-latest-news/public-safety-list/', '/news-releases/policy-public-interest-latest-news/trade-policy-list/', '/news-releases/policy-public-interest-latest-news/us-state-policy-news-list/', '/news-releases/multicultural-latest-news/', '/news-releases/multicultural-latest-news/multicultural-latest-news-list/', '/news-releases/multicultural-latest-news/native-american-list/', '/news-releases/multicultural-latest-news/', '/news-releases/multicultural-latest-news/african-american-related-news-list/', '/news-releases/multicultural-latest-news/asian-related-news-list/', '/news-releases/multicultural-latest-news/children-related-news-list/', '/news-releases/multicultural-latest-news/hispanic-oriented-news-list/', '/news-releases/multicultural-latest-news/lesbian-gay-bisexual-list/', '/news-releases/multicultural-latest-news/mens-interest-list/', '/news-releases/multicultural-latest-news/people-with-disabilities-list/', '/news-releases/multicultural-latest-news/religion-list/', '/news-releases/multicultural-latest-news/senior-citizens-list/', '/news-releases/multicultural-latest-news/veterans-list/', '/news-releases/multicultural-latest-news/women-related-news-list/', '/news-releases/multimedia/', '/news-releases/latest-news-topics/', '/news-releases/automotive-transportation-latest-news/', '/news-releases/business-technology-latest-news/', '/news-releases/entertainment-media-latest-news/', '/news-releases/financial-services-latest-news/', '/news-releases/general-business-latest-news/', '/news-releases/consumer-technology-latest-news/', '/news-releases/energy-latest-news/', '/news-releases/environment-latest-news/', '/news-releases/heavy-industry-manufacturing-latest-news/', '/news-releases/telecommunications-latest-news/', '/news-releases/consumer-products-retail-latest-news/', '/news-releases/entertainment-media-latest-news/', '/news-releases/health-latest-news/', '/news-releases/sports-latest-news/', '/news-releases/travel-latest-news/', '/news-releases/multicultural-latest-news/',]

            if i['href'] in filterList:
                pass
            else:
                articleCount = articleCount + 1
                articleLink = baseLink + i['href']

                r2 = requests.get(articleLink)
                if (r2.status_code == 200):
                    rawArticle = BeautifulSoup(r2.content, "html.parser")
                    articleHeading = rawArticle.h1.contents[0]

                    contentContainer = rawArticle.find_all(attrs={'class': 'col-sm-10 col-sm-offset-1'})
                    articleContent = ""

                    for x in contentContainer:
                        for child in x.children:
                            if (child.name == 'p'):
                                # Need to go a level deeper to filter out links, spans, and sub-headings
                                for subchild in child:
                                    # Type check to filter out links, spans, etc
                                    if isinstance(subchild, NavigableString):
                                        #only process the paragraph if it has more than 300 characters
                                        if len(subchild) > 300:
                                            articleContent += " " + subchild
                    

                    csv_push = {
                        'article_number': articleCount,
                        'article_link': articleLink,
                        'article_name': articleHeading,
                        'article_content': articleContent,
                    }
                    csv_content.append(csv_push)
        
        if (len(csv_content) > 0):
            try:
                with open(csv_file, 'w') as csvfile:
                    writer = csv.DictWriter(csvfile, fieldnames=csv_columns)
                    writer.writeheader()
                    for data in csv_content:
                        writer.writerow(data)
                    print("Successfully created csv file")
            except IOError:
                print("I/O error")